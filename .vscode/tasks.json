{
  // See https://go.microsoft.com/fwlink/?LinkId=733558
  // for the documentation about the tasks.json format
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Clean Main",
      "type": "shell",
      "command": "rm -f build/* || true",
      "problemMatcher": []
    },
    {
      "label": "Clean Tests",
      "type": "shell",
      "command": "rm -f build/* main test-suite || true",
      "problemMatcher": []
    },
    {
      "label": "Build Main",
      "type": "shell",
      "command": [
        "vendor/cc65/bin/cl65",
        "-o build/main.prg",
        "--asm-include-dir vendor/cc65/asminc",
        "--asm-include-dir vendor/cc65/libsrc",
        "-L vendor/cc65/lib",
        "-Ln build/main.labels",
        "-u __EXEHDR__",
        "-t c64",
        "-C c64-asm.cfg",
        "main.asm"
      ],
      "dependsOn": ["Clean Main"],
      "problemMatcher": ["$ca65", "$ld65", "$ld65-config", "$ld65-unresolved"]
    },
    {
      "label": "Build Tests",
      "type": "shell",
      "options": {
        "env": {
          "CA65_INC": "vendor/c64unit/cross-assemblers/ca65"
        }
      },
      "command": [
        "vendor/cc65/bin/cl65",
        "-Oir",
        "-t c64",
        "--asm-include-dir vendor/cc65/asminc",
        "-L vendor/cc65/lib",
        "-Ln build/test-suite.labels",
    // "-prg", sessionState.prgfilename,
        // "-I vendor/c64unit/cross-assemblers/ca65",
        // "-I tests/test-cases",
        // "-I src",
        "-C tests/c64unit.cfg",
        "-o build/test-suite.prg",
        "test-suite.asm"
      ],
      "dependsOn": ["Clean Tests"],
      "problemMatcher": ["$ca65", "$ld65", "$ld65-config", "$ld65-unresolved"]
    },

    {
      "label": "Launch VICE",
      "type": "shell",
      "command": "/usr/local/bin/x64sc build/main.prg",
      "problemMatcher": {
        // The problem is owned by the cpp language service.
        "owner": "x64sc",
        "fileLocation": ["relative", "${workspaceFolder}"],
        "pattern": {
          "regexp": "^.+(Error|Warning) - `(.+)' (.+)$",
          "severity": 1,
          "file": 2,
          "message": 3
        }
      }
    },

    {
      "label": "Launch Tests",
      "type": "shell",
      "command": "/usr/local/bin/x64sc build/test-suite.prg",
      "problemMatcher": {
        // The problem is owned by the cpp language service.
        "owner": "x64sc",
        "fileLocation": ["relative", "${workspaceFolder}"],
        "pattern": {
          "regexp": "^.+(Error|Warning) - `(.+)' (.+)$",
          "severity": 1,
          "file": 2,
          "message": 3
        }
      }
    },

    {
      "label": "run",
      "dependsOn": ["Build Main", "Launch VICE"],
      "problemMatcher": {
        // The problem is owned by the cpp language service.
        "owner": "x64sc",
        "fileLocation": ["relative", "${workspaceFolder}"],
        "pattern": {
          "regexp": "^.+(Error|Warning) - `(.+)' (.+)$",
          "severity": 1,
          "file": 2,
          "message": 3
        }
      }
    },

    {
      "label": "debug",
      "dependsOn": ["Build Main", "Launch VICE"]
    },

    {
      "label": "test",
      "dependsOn": ["Build Tests", "Launch Tests"],
      "group": "test",
      "problemMatcher": {
        // The problem is owned by the cpp language service.
        "owner": "x64sc",
        "fileLocation": ["relative", "${workspaceFolder}"],
        "pattern": {
          "regexp": "^.+(Error|Warning) - `(.+)' (.+)$",
          "severity": 1,
          "file": 2,
          "message": 3
        }
      }
    },
    {
      "label": "test-debug",
      "dependsOn": ["Build Tests"],
      "isBackground": true,
      "command": [
        "./bin/c64-debugger.sh"
      ],
      "args": [
        "build/test-suite.prg",
        "build/test-suite.labels"
        // TODO: Add symbols
      ],
      "group": "test",
      "problemMatcher": []
    },
    {
      "label": "run-debug",
      "dependsOn": ["Build Main"],
      "isBackground": true,
      "command": [
        "./bin/c64-debugger.sh"
      ],
      "args": [
        "${workspaceFolder}/build/main.prg",
        "${workspaceFolder}/build/main.labels"
        // TODO: Add symbols
      ],
      "problemMatcher": []
    }
    // For C64Debugger
    // "-pass",
    // "-symbols", sessionState.labelsFilename,
  ]
}